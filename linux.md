# Linux 常用命令

## 文件和目录

### 前置知识

#### shell 中的文件名通配符
| 符号 | 含义 |
| :------: | :------: |
| * |匹配任意长度字符串（包括空字符串）。特例：当文件通配符第一个字符为``*``时，不匹配以``.``开头的文件。|
|？|匹配一个字符。|
|[]|匹配方括号内任意一个字符。可以用'**-**'指定一个范围。例如：``[A-Z]*``匹配所有以大写字母开头的文件|

**shell在执行某个命令前会先对文件通配符做展开工作，然后才执行命令**

#### linux中的文件类型
| 符号 | 类型 | 含义 |
| :------: | :------: | :------: |
| - | 普通文件 | 包括纯文本文件(ASCII)；二进制文件(binary)；数据格式的文件(data);各种压缩文件. |
| d | 目录文件 | 能用 ``cd`` 命令进入的 |
| b | 块设备文件 | 就是存储数据以供系统存取的接口设备，简单而言就是硬盘。 |
| c | 字符设备 | 即串行端口的接口设备，例如键盘、鼠标等等。 |
| s | 套接字文件 | 可以启动一个程序来监听客户端的要求，客户端就可以通过套接字来进行数据通信。第一个属性为 [s]，最常在 /var/run目录中看到这种文件类型  |
| p | 管道文件 | 用于进程间通信 |
| l | 符号链接文件 | 类似windows中的快捷方式 |

### 文件管理
#### ls命令
##### 基本用法
- **ls**命令后面不给出任何名字时，列出当前目录下所有文件和目录
- 名字为文件时，列出该文件名
- 名字为目录时，不列出目录名，而是列出列出该目录下所有的文件和子目录。
- 在同一命令行中可以指定多个名字，可以配合通配符使用，这是的执行逻辑结合2、3点。

##### eg：
当前目录结构如下图
```
.
├── a
│   └── b
│       └── c
└── linux.md
```

执行``ls``
```
a  linux.md
```
执行 ``ls a``
```
b
```

执行``ls *``
```
linux.md

a:
b
```

##### 常用参数
- -a
列出所有(all)项，包括以``.``开头的隐藏文件。

- -R
递归地列出所碰到的子目录(Recursion)。

- -F
标记每个文件(Flag)。
标记规则：
	- 目录：在文件名后加``/``
	- 可执行文件：在文件名后加 ``*``
	- 符号链接文件：在文件名后加``@``
	- 管道文件：在文件名后加``|``
	- 普通文件：无标记

- -d
若**ls**后的名字为目录，则列出目录名，不列出目录下的文件和子目录。
eg：``ls * -d`` 等价于 ``ls``

- -l
长格式列表(long)。
第一列第1个字符为文件格式，2-4个字符标识所有者权限，5-7标识同组用户权限，8-10个字符标识其他用户权限
第2列是文件的link数(i结点被引用的次数)
第3、4列是文件主的名字和组名
第5列是文件大小
第六列是最后一次被修改时间
第七列是文件名

#### ll命令
等价于``ls -al``

#### cp命令
##### 基本用法
- cp file1 file2
把文件file1复制到file2

- cp file1 file2 ... filen dir
把文件file1 file2 ... filen复制到已存在目录dir

##### 常用参数
- -r/-R
	递归的复制目录
	
- -d
	不复制软链接
	
- -n
	不服该已存在目录
- -a
	相当于``-dr``
	
#### mv命令
##### 基本用法
- mv existing-file-or-dir new-name
	常用于修改文件名
- mv file1 file2 ... filen dir
	把多个文件或目录移动到已存在目录dir中
	
##### 常用参数
- -f
	覆盖前不提示
	
- -i
	覆盖前询问
	
- -n
	不覆盖已存在文件
	
#### rm命令

##### 基本用法
- rm file1 file2 ... filen
	删除file1 ... filen
	
##### 常用参数
- -f
	忽略不存在的文件和参数，不提示
	
- -i
	每次删除前都提示
	
- -r/-R
	递归删除目录
	
#### find命令
**find**命令在一个指定的范围内查找符合条件的文件或者路目，然后执行相应的动作。

eg：
``find dir1 dir2 -name '*.[ch]' -print`` ：
表示在**dir1**和**dir2**中查找所有以**.c**或**.h**结尾的文件，然后打印出文件路径。在这条命令中**find**和**-name**之间指定查找范围；**-name**指定查找条件，在这里可以使用**\*,?,[]**通配符，但是这里的通配符是find命令处理的，而不需要**shell**展开，因此需要放在引号内；**-print**表示查找到符合条件的文件后执行的动作。

##### 关于“条件”的选项
- -name
	文件名的匹配。可以使用通配符，但需要放在引号内。
	
- -type
	文件类型的匹配。例如：``-type d``表示匹配文件目录。
	
- -size ±n[b/c/w/k/M/G]
	文件大小的匹配。正号表示大于，负号标识小于，无符号表示等于。数字后可加单位，默认为b（需注意大小写）。
	- b 块
	- c 字节
	- w 字
	- k 千字节
	- M 兆
	- G 
	例如：
	``-size +100``：表示长度大于100块。
	``-size +100c``：表示长度大于100字节。
	
- -mtime ±n：
	文件最近修改(modify)时间。单位为天。
	
- -atime ±n：
	文件最近访问(access)时间。单位为天。
	
- -user：
	指定文件主。
	
- -group：
	指定组。
	
更多选项可使用``man find``查看。

选项间不用符号连接表示且，用！链接表示非，用-o链接表示或。

##### 关于动作
- -print  打印符合条件的文件名。
- exec， -ok 对符合条件的查找执行某个命令。两者的区别在于**-ok**在执行命令前需要确认。

eg：
``find . -name '*.[ch] -exec cat {} \;'``
表示用cat命令打开以**.c**或**.h**结尾的文件。``{}``表示查找到的文件路径(中间无空格)，大括号后的空格不能省，``\``转义，使得**find**命令可以看到分号。

#### pwd命令
打印当前工作目录(print working  directory)。

#### mkdir命令
创建路目
eg：``mkdir hello/world`` 在**hello**目录下创建**world**目录。**hello**目录需存在，否则失败。

**mkdir**除了创建目录外，还在目录中创建**.目录**和**..目录**。

#### tar命令
文件归档
这个命令主要掌握常用几个参数，会创建/解压等常规操作就ok。

##### 常用参数
- -c 
	create创建新tar文件。
	
- -v
	冗长(verbose)。每处理完一个文件，久打印出文件名，并冠以功能字母。
	
- -f
	指定设备文件名。
	
- -x
	抽取(extract)。解压。
	
- -u
	更新(update)。在末尾追加。若已经存在旧版本，则不删除旧版本，把新版本追加在尾部。
	
##### 常用操作

- 创建tar文件
``tar -cvf a.tar filelist``

- 解压tar文件
``tar -xvf a.tar``
``tar -xvf a.tar filelist`` 提取a.tar中的filelist
``tar -uvf a.tar filelist`` 更新a.tar中的filelist
``tar --delete -vf a.tar filelist`` 删除a.tar中的filelist

#### compress命令
采用LZW算法压缩文件，普通文本文件可压缩掉50%~80%。

#### uncompress命令
解压压缩文件。

eg：
```
	tar -cvf a.tar *  		将但前目录中所有文件打包到a.tar
	compress a.tar		压缩a.tar，产生a.tar.Z
	将a.tar.Z通过网络发送
	umcompress a.tat.Z 	解压得到a.tar
	tar -xvf t.tar			得到所有原始文件
```
#### chmod命令

#### tree命令

#### 

## 文本处理
### 前置知识

在 b-shell 中，**0**标识输入设备（键盘）文件描述符，**1**标识正常输入设备（终端）文件描述符,**2**表示错误输出设备（设备）文件描述符。

#### 输入重定向
- < 文件
将标准输入重定向到一个磁盘文件。

- << 定界符
从**shell**中获取数据，直到下次遇到定界符。
需要注意的是：shell会对定界符之间的内容做命令替换和变量替换，
例如：
```
cat << test
> $HOME
> `date`
> test
```
输出结果为：
```
/home/yimi
2018年 09月 20日 星期四 15:18:04 CST
```
输出结果并不是界定符之间的内容。
解决办法为：**第一个定界符用单引号括起来或者在第一个定界符前加反斜杠**
```
cat << 'test'
> $HOME
> `date`
> test
```
或者
```
cat << \test
> $HOME
> `date`
> test
```
cat输出的就是原生内容了。

#### 输出重定向
- \> 文件
将标准输出重定向到一个磁盘文件，如果文件已存在，则覆盖。

- \>\> 文件
将标准输出重定向到一个磁盘文件，如果文件已存在，则追加到文件尾部。

- 2 > 文件
将标准输出重定向到一个磁盘文件。

- 文件描述符 > &文件描述符
指定文件描述符重定向

eg：
``cmd > log 2 > &1``将标准输出和标准错误输出都重定向到**log**文件。

``cmd 1 > log 2 > &1`` 同上。

#### 管道
- cmd1 > cmd2 
将**cmd1**的标准输出作为**cmd2**的输入。

- cmd1 2 > &1 | cmd2
将**cmd1**的标准输出和标准错误输出作为**cmd2**的输入。

### 常用命令

#### cat命令
用于列出文本文件的内容。
当cat命令接收的文件个数为0时，从标准输入获取内容，当文件数大于1时，按顺序打印所有文件内容。

#### od命令
八进制打印文件内容。

- -x选项
	十六进制打印
	
- -c选项
	课打印字符，打印出字符，不可打印字符，打印出ASCII码。
	
#### head命令
- head -n file
打印file中的前n行

#### tail命令
- tail -n file
打印出file中最后n行

- taile -nf file
打印file中最后n行，打印后并不退出，当file中有追加时，打印出追加内容。

#### wc命令
字计数
- wc filelist
统计filelist中的字。
输出第一列为行数，第二行为单词数，第三行为字符数，第四行为文件名。

##### 常用参数
- -l
	只统计行数
	
- -c
	统计byte数
	
- -w
	只统计单词数

- -m
	统计字符数
	
#### sort命令
对文件内容排序。

##### 常用参数
- b
	忽略行首空格
	
- d
	字典序
	
- g
	按数字大小排序
	
- f
	需略大小写
	
- i
	忽略不可打印字符

- -r
	reverse，逆序
	
- -R
	随机打乱，但是相同大小的行会在一起

- -t 
	指定分隔符

- -k
	指定按第k列排序
	
- -o
	指定输出文件
	
#### tee命令
三通，将从stdin得到的数据抄送到标准输出strout显示，同时存入磁盘文件。eg：
``cmd | tee cmd.log``

#### grep命令

##### 正则表达式中的特殊字符
**和shell中的通配符不同**

| 符号 | 含义 |
| :-------: | :-------: |
| . | 匹配任意一个字符 |
| * | 正则表达式后跟星号，表示匹配此单词符正则表达式的0次或任意次出现 |
|  [ | 匹配左方括号和右方括号之间集合中中的任意一个字符，可用减号(-)连接2个字符定义一个区间；**^**放在集合开始表示补集  |
| \ | 取消特殊字符的含义 |
| ^ | 在**[]**中的开始表示补集，在正则表达式的开始，标识以**^**后的开始 |
| $ | 放在正则表达式末尾，表示以**$**前的结尾|


- grep patten filelist
当文件数小于1时，从标准输入读取数据，当文件数大于1时，查找到指定字符串时，整个行，联通该行处的文件名一起显示。

#### egrep命令
扩展正则表达式，可以使用'**()**'，？标识0次或1次出现，+表示一次或多次出现，表达式之间可以用**'|'**连接。

#### fgrep命令
快速字符串搜索，而不是按模式匹配。

##### 常用参数
grep/egrep/fgrep 都可使用下列参数：

- -n
	显示行号

- -i
	忽略大小写

- -v 
	显示所有不包含模式串的行
	
#### awk脚本
awk逐行扫描文件，并进行处理。扫描行满足某个条件（condition）时，就执行相应的代码块。若代码块未指定条件，则所有的行都匹配。
##### 语法
awk程序的基本格式：
```
condition { action }
condition { action }
```
###### awk中常用的内置变量

| 变量名 | 说明 |
| :-------: | :-------: |
| FILENAME | 当前输入文件的名字 |
|  $0 | 当前记录（作为单个变量）|
| $1 ... Sn| 当前记录的第n个字段，字段间由FS分隔 |
| FS | （Field Separator）输入字段分隔符 默认是K空白|
| NF | 当前记录中的字段个数，就是有多少列 |
| NR | 已经读出的记录数，就是行号，从1开始 |
| RS | （Record Separator）入的记录分隔符默认为换行符 |

###### conditon
描述条件的方式有以下几种：

- 如果不指定任何条件，那么对文本文件的所有行进行处理
- 可以使用与C语言类似的关系运算符
- 正则表达式匹配，描述方法：``/pattern/``
- 特殊的条件：**BEGIN**和**END**。**BEGIN**后的动作，在**awk**开始处理所有文本之前执行；**END**之后的动作，在**awk**处理完所有文本之后执行。

###### action
在动作部分，awk允许用户使用用户变量、条件和循环、函数、数组（map）。awk还提供了大量的内置函数，这里不再展开了，可以百度。

###### awk命令
用法：和其他文本处理命令一样，awk支持处理0个到多个文件。
- awk `program` filelist
- awk -f program-file filelist

常用参数：
- -f/--file
	指定程序文件
- -F/--field-separator
	FS(field-separator)，支持正则表达式

eg：	
下来写个例子，把刚才的知识点用一遍：
```
题目描述
统计一篇文章中单词出现的频率、每个字母出现的频率（不区分大小写）和空行数。
单词和单词间用逗号、句号、问号、感叹号、双引号、连字符、冒号、括号分隔。假设单词中不会出现其他符号。
```
这个任务用**awk**，可能不是最适合的，在这里只作为练习。

```
# usage： awk -f word_count.awk file

BEGIN {
	printf("=============== %s word count test ===============\n", FILENAME);
	# 指定分隔符
	FS = "[,.?!\"-:() ]+";
}

# 统计逻辑
function count(word) {
	# 如果一行以分隔符开始或结尾，则会在一行开始之前或结束后多一个空字符串
	if(word == "") return;
	words[word]++;
	words_cnt++;
	split(word, chars, "")
	for (j = 1; j <= length(word); j++) {
		if(chars[j] == "'") continue;
		letters[chars[j]]++;
		letters_cnt++;
	}
}

# 获取单词或字母的出现频率
function get_frequency(s, is_word) {
	if(is_word == 1) {
		return words[s]*1.0/words_cnt;
	} else {
		return letters[s]*1.0/letters_cnt;
	}
}

# 统计空行数
NF <= 0 {
	blank_lines++;
}

NF > 0 {
	for (i = 1; i <= NF; i++) {
		word = tolower($i);
		count(word);
	}
}

END {
	printf("All Words:      %d\n", words_cnt);
	printf("All Letters:    %d\n", letters_cnt);
	printf("All Blank Line: %d\n", blank_lines);
	print "-------------------------------------------"
	for (letter in letters) {
		printf("%s:\t%.2f\n", letter, get_frequency(letter, 0));
	}
	print "-------------------------------------------"
	for (word in words) {
		printf("%s:\t%.2f\n", word, get_frequency(word, 1));
	}
	printf("=============== %s test end ===============\n", FILENAME);
}
```

#### sed命令

#### tr命令

### 网络相关

#### ifconfig命令

#### ping命令

#### curl命令

#### wget命令

#### tracepath命令

#### traceroute命令

#### mtr命令

#### host命令

#### whois命令

#### dhclient命令

#### netstat命令

### 进程相关

#### ps命令

#### kill命令

###资源监控

#### lsof命令

#### free命令

#### top命令

